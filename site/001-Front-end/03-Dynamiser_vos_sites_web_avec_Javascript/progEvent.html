<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Ce site présente mes notes de cours sur ma formation STUDI de Graduate développeur 
  PHP / Symfony.">
  <link rel="stylesheet" href="../../style.css">
  <title>Notes - Graduate développeur PHP/Symfony</title>
</head>
<body>
  <header id="up">
    <h1 class="shape-title">Dynamiser vos sites web avec Javascript</h1>
  </header>
  <a href="dynSiteWebJSMenu.html" class="bgc-up">Retour</a>
  <main>
    <h2>La programmation événementielle en Javascript</h2>
    <nav>
      <section class="return" >
        <h2 class="sub-title-h2">Sommaire</h2>
      </section>
      <ul class="li-empty">
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#events">Les événements</a></li>
        <li><a href="#types">Les types d'événements</a></li>
        <li><a href="#propagation">La propagation des événements</a></li>
        <li><a href="#ajout-event">Ajouter/Supprimer un événement au DOM</a></li>
      </ul>
    </nav>
    <section class="bgc-section">
      <h2 id="intro" class="sub-title-h3">Introduction</h2>
      <article>
        <h3>Le DOM</h3>
        <p>
          Cela consiste à manipuler des objets, éléments, événements et différentes fonctions pour mettre en place des 
          interactions avec l'utilisateur. Nous parlerons alors d'interface web réactive.
        </p>
        <p>
          L'un des éléments centraux de la programmation événementielle en JavaScript est le <strong>DOM</strong> pour 
          <b>D</b>ocument <b>O</b>bject <b>M</b>odel. Il s'agit tout simplement de l'arborescence d'une page HTML.<br>
          Il faut voir le DOM comme un ensemble d'objets avec des propriétés, des méthodes et des gestionnaires 
          d'événements.
        </p>
        <div class="blquote-container">
          <img class="img" src="images/DOM-model.svg" alt="Modèle de DOM">
          <blockquote class="blquote">
            <cite>
              Par ‍Birger Eriksson — Travail personnel, CC BY-SA 3.0, 
              <a class="link-a" href="https://commons.wikimedia.org/w/index.php?curid=18034500" target="_blank">
                https://commons.wikimedia.org/w/index.php?curid=18034500
              </a>
            </cite>
          </blockquote>
        </div>
      </article>
      <p class="bgc-up"><a href="#up">Haut</a></p>
    </section>
    <section class="bgc-section">
      <h2 id="events" class="sub-title-h3">Les événements</h2>
      <article>
        <h3>L'objet Event</h3>
        <p>
          L'objet Event est un événement JavaScript contenant différentes propriétés et méthodes communes à tous les 
          événements.<br>
        </p>
        <p>En voici quelques-unes :</p>
        <ul>
          <li><strong>Propriétés :</strong></li>
            <ul>
              <li><strong>Event.target :</strong> cible de l'événement,</li>
              <li><strong>Event.defaultPrevented :</strong>  indique si le comportement par défaut de l’interaction doit 
                être annulé,
              </li>
              <li><strong>Event.bubbles : </strong>indique le sens de propagation de l'événement.</li>
            </ul>
          <li><strong>Méthodes :</strong></li>
            <ul>
              <li><strong>Event.createEvent() : </strong>crée un nouvel événement</li>
              <li><strong>Event.preventDefault() : </strong>annule le comportement par défaut de l'événement</li>
              <li><strong>Event.stopPropagation() : </strong>arrête la propagation de l'événement</li>
            </ul>
        </ul>
      </article>
      <p class="bgc-up"><a href="#up">Haut</a></p>
    </section>  
    <section class="bgc-section">
      <h2 id="types" class="sub-title-h3">Les types d'événements</h2>
      <article>
        <h3>Les événements globaux :</h3>
        <p>
          Ils ne sont pas liés à une interaction utilisateur mais plutôt à une action de script.
        </p>
        <p>En voici quelques-uns :</p>
        <ul class="ul-p17">
          <li><strong>offline : </strong>automatiquement déclenché quand le navigateur a perdu sa connexion à Internet.
          </li>
          <li><strong>abort : </strong>déclenché quand le chargement d'une ressource a été interrompu par l'utilisateur.
          </li>
          <li><strong>ended : </strong>déclenché à la fin de la lecture d'un média ou lorsque la source du média ne 
            permet plus l'envoi des données.
          </li>
          <li><strong>success : </strong>déclenché quand une requête HTTP s'est déroulée correctement.
          </li>
        </ul>
        <div class="code">
          <code>
            window.addEventListener("load", function(event) {<br>
              console.log("Les ressources de la page ont été chargées !");<br>
            });
          </code>
        </div>
      </article>
      <article>
        <h3>Les événements souris :</h3>
        <p>
          Ils permettent d'écouter un ensemble d'interactions que l'utilisateur peut faire avec sa souris.
        </p>
        <p>En voici quelques-uns :</p>
        <ul class="ul-p17">
          <li><strong>click : </strong>déclenché quand l'utilisateur clique sur un élément du <b>DOM</b>.</li>
          <li><strong>mouseenter : </strong>déclenché quand l'utilisateur pointe la souris sur un élément.</li>
          <li><strong>mouseleave : </strong>déclenché quand l'utilisateur déplace le pointeur de la souris en dehors 
            d'un élément.
          </li>
          <li><strong>mouseup : </strong>déclenché quand l'utilisateur relâche un bouton de la souris lorsqu'il se 
            trouve sur un élément.
          </li>
        </ul>
        <div class="red">
          <h4>Mauvaises pratiques</h4>
          <p>
            Évitez l'utilisation des événements mouseover et mouseout qui déclencheront l'événement autant de fois qu'il y 
            a de descendants qui lui sont liés.<br>
            <b><i>mouseenter</i></b> ou <b><i>mouseleave</i></b> ne se déclenchent que pour l'élément auquel ils sont 
            associés.
          </p>
        </div>
        <div class="code">
          <code>
            var button = document.getElementById('button');<br>
            function evenement() {<br>
              alert('Vous avez cliqué sur le bouton');<br>
            }<br><br>
            button.addEventListener('click', evenement);
          </code>
        </div>
      </article>
      <article>
        <h3>Les événements claviers :</h3>
        <p>
          Ces événements sont liés lors d'une pressions sur le clavier par l'utilisateur.
        </p>
        <p>En voici quelques-uns :</p>
        <ul class="ul-p17">
          <li><strong>keyup : </strong>déclenché quand l'utilisateur relâche une touche du clavier.</li>
          <li><strong>keydown : </strong>déclenché quand l'utilisateur maintient enfoncée une touche du clavier.</li>
        </ul>
        <div class="red">
          <h4>Mauvaises pratiques</h4>
          <p>
            L'événement <b><i>keypress</i></b> est à proscrire, car il ne fonctionne pas pour toutes les touches du 
            clavier (Alt, Ctrl, Shift, par exemple). La documentation l'indiqué comme étant déprécié et ne sera bientôt 
            plus supporté par les navigateurs.
          </p>
        </div>
        <div class="code">
          <code>
            var key = document.getElementById('key');<br>
            function keyboard() {<br>
              alert('Vous venez d\'appuyer sur une touche du clavier');<br>
            }<br><br>
            key.addEventListener('keydown', keyboard);
          </code>
        </div>
      </article>
      <article>
        <h3>Les événements de formulaires :</h3>
        <p>Interagit avec tous les éléments d'un formulaire HTML.</p>
        <div class="code">
          <code>
            var form = document.getElementById('form');<br>
            function form() {<br>
              alert('Vous êtes sur le point de soumettre le formulaire');<br>
            }<br><br>
            form.addEventListener('submit', form);
          </code>
        </div>
      </article>
      <article class="comment">
        <h4 >Bonnes pratiques</h4>
        <p>Attention de bien utiliser les événements en JavaScript car dans le cas contraire, ils consommeront 
          beaucoup de ressources navigateur.<br>
          Dans le cas ou un utilisateur appuie sur un touche plusieurs fois, les appels à la fonction liée peuvent 
          ralentir l'application. Pour éviter ce comportement, il est possible de coupler le déclenchement des 
          événements avec les fonctions <strong>debounce()</strong> et <strong>throttle()</strong>.
        </p>
        <ul class="ul-p17">
          <li><strong>debounce() </strong> permet de bloquer l'appel à une fonction pendant un certain délai 
            (en millisecondes).
          </li>
          <li><strong>throttle() </strong>permet de reporter les appels à une fonction pendant un certain délai 
            (en millisecondes).
          </li>
        </ul>
      </article>
      <p class="bgc-up"><a href="#up">Haut</a></p>
    </section>
    <section class="bgc-section">
      <h2 id="propagation" class="sub-title-h3">La propagation des événements</h2>
      <h3>Capture et bouillonnement</h3>
      <p>Deux phases régissent les événements en JavaScript :</p>
      <ol class="ul-p17">
        <li><strong>la capture</strong>,</li>
        <li><strong>le bouillonnement</strong>.</li>
      </ol>
      <p>Lorsqu'un élément est déclenché, JS parcours tout le code de l'ancêtre le plus haut jusqu'à l'élément 
        déclencheur de l'événement.<br>
        C'est la phase de <b>capture</b>.<br>
        Puis JS parcours le code en sens inverse et ce n'est qu'à ce moment qu'il le déclenche.<br>
        C'est la phase de <b>bouillonnement</b>.<br>
      </p>
      <div class="code">
        <code>
          const parent = document.getElementById('parent');<br>
          const children = document.getElementById('children');<br><br>
          parent.addEventListener('click', () => {<br>
          <span class="tab">alert('parent')</span><br>
          })<br><br>
          children.addEventListener('click', () => {<br>
          <span class="tab">alert('children')</span><br>
          })<br>
        </code>
      </div>
      <p>
        Dans l'exemple ci-dessus, un click sur l'élément children affichera l'alert <i>children</i> puis l'alert 
        <i>parent</i>.<br>
        Il existe 2 solutions pour modififier ce comportement.
      </p>
      <ul class="ul-p17">
        <li><strong>Event.stopPropagation()</strong></li>
        <li>modifier le <strong>3<sup>ème</sup> paramètre optionnel</strong> de la méthode document.addEventListener()</li>
      </ul>
      <article>
        <h3 class="sub-title-h3">Event.stopPropagation()</h3>
        <p>
          Placez cette méthode à l'intérieur de la fonction de callback de l’élément écouteur.
          La méthode stopPropagation() va annuler la phase de bouillonnement et ne remontera pas jusqu'à la div parent.
        </p>
        <div class="code">
          <code>
            const parent = document.getElementById('parent');<br>
            const children = document.getElementById('children');<br><br>
            parent.addEventListener('click', () => {<br>
            <span class="tab">alert('parent')</span><br>
            })<br><br>
            <span class="console">// event en parametre de la fonction de callback représente l'évènement.</span>
            children.addEventListener('click', (event) => {
            <span class="tab red">event.stopPropagation();</span><br>
            <span class="tab">alert('children')</span><br>
            })
          </code>
        </div>
      </article>
      <h3 class="sub-title-h3">addEventListener('event', callback, capture?)</h3>
      <article>
        <p>
          En passant à <b>true</b> le 3<sup>ème</sup> paramètre optionnel de la méthode addEventListener() l'événements 
          sera déclenché lors de la phase de capture.
        </p>
        <div class="code">
          <code>
            const parent = document.getElementById('parent');<br>
            const children = document.getElementById('children');<br><br>
            parent.addEventListener('click', () => {<br>
            <span class="tab">alert('parent')</span><br>
            }, <span class="red">true</span>)<br><br>
            children.addEventListener('click', () => {<br>
            <span class="tab">alert('children')</span><br>
            }, <span class="red">true</span>)
          </code>
        </div>
        <p>Dans l'exemple ci-dessus, <i>parent</i> sera affiché avant <i>children</i>.</p>
      </article>
      <p class="bgc-up"><a href="#up">Haut</a></p>
    </section>
    <section class="bgc-section">
      <h2 id="ajout-event" class="sub-title-h3">Ajouter/Supprimer un événement au DOM</h2>
      <article>
        <h3 class="sub-title-h3">Les sélecteurs</h3>
        <p>
          Il nous faudra parfois manipuler des événements. L'objet <b>document</b> met à notre disponition des 
          méthodes : <b>les sélecteurs</b>.<br>
        </p>
        <p class="red"><b>Fondamental :<br>
          Pour permettre aux sélecteurs d'accéder au DOM, il faut utiliser l'objet JavaScript 
          <code class="code-inline">document</code> point d'entrée de notre page web.</b>
        </p>
        <p>Voici quelques sélecteurs :</p>
        <ul class="ul-p17">
          <li><strong>document.getElementById(<span class="console">'title'</span>) :</strong>
            renvoie l'élément de DOM qui possède l'id <span class="console"><b>#title</b></span>. Pour 
              rappel, un identifiant doit être unique dans la page</b>.
          </li>
          <li><strong>document.getElementsByName('email-input') :</strong> renvoie l'élément de DOM qui possède l'id 
            <span class="console"><b>name #email-input</b></span>.
          </li>
          <li><strong>document.getElementsByTagName(<span class="console">'p'</span>) :</strong> renvoie un tableau 
            d'éléments de DOM qui correspondent à la balise <span class="console">p</span>.
          </li>
          <li><strong>document.getElementsByClassName(<span class="console">'navbar'</span>) :</strong> renvoie un 
            tableau d'éléments de DOM qui correspondent à la classe CSS <span class="console"><b>navbar</b></span>.
          </li>
          <li><strong>document.querySelector(<span class="console"><b>'h3.subtitle'</b></span>) : </strong> renvoie l'élément 
            DOM trouvé qui correspond au sélecteur CSS <span class="console"><b>h3.subtitle</b></span>.
          </li>
        </ul>
        <p>Il est possible d'enchaîner plusieurs sélecteurs :</p>
        <div class="code">
          <code>
            &#60;div id="<span class="red">myDiv</span>"&#62;<br>
            <span class="tab">&#60;<span class="red">p</span>&#62;un paragraphe&#60;<span class="red">p</span>&#62;<br>
            <span class="tab">&#60;span&#62;un span&#60;/span&#62;</span><br>
            &#60;/div&#62;<br><br>
            <span class="comment">document.getElementById(<span class="red">'myDiv'</span>).getElementsByTagName(
              <span class="red">'p'</span>)</span>
          </code>
        </div>
      </article>
      <article>
        <h3 class="sub-title-h3">AddEventListener</h3>
        <p>Permet de lier un événement de DOM. Prend en général 2 paramètres :</p>
        <ul class="ul-p17">
          <li><b>type :</b> représenté par une chaîne de caractères,</li>
          <li><b>listener :</b> fonction JavaScript qui sera exécutée lors de l'émission de l'événement.</li>
        </ul>
        <p>Paramètres facultatifs :</p>
        <ul class="ul-p17">
          <li><b>capture :</b> booléen indiquant le sens de propagation de l'événement : parent &#62; élément, ou 
            élément &#62; parent.
          </li>
          <li><b>once : </b> booléen indiquant la suppression de l'événement après son appel 
            (<code class="code-inline">true</code> ou <code class="code-inline">false</code>).
          </li>
        </ul>
      </article>
      <article>
        <h3 class="sub-title-h3">RemoveEventListener</h3>
        <p>Il est très coûteux d'observer un nœud de DOM. C'est pourquoi il est fortement recommandé de supprimer un 
          eventListener quand on en a plus besoin.<br>
          <code class="code-inline">RemoveEventListener</code> prend les mêmes paramètres que 
          <code class="code-inline">AddEventListener</code>.
        </p>
        <div class="code">
          <code>
            element.addEventListener("click", clickMe); <br><br>
            element.removeEventListener("click", myFunction); <span class="comment">// Ne fonctionnera pas car le 
              paramètre listener n'est pas le même</span> <br>
            element.removeEventListener("mousedown", clickMe); <span class="comment">// Ne fonctionnera pas car le 
              paramètre type n'est pas le même</span> <br>
            element.removeEventListener("click", clickMe); <span class="comment">// Fonctionnera</span>
          </code>
        </div>
      </article>
      <article>
        <h3 class="sub-title-h3">La délégation d'événement</h3>
        <p>La délégation d'événement permet de lier un événement non pas sur l'élément ciblé, mais sur l'un de ses 
          ancêtres.
        </p>
        <div class="code">
          <code>
            &#60;body&#62;<br> 
              &#60;div id="event"&#62;<br>
              <span class="tab">&#60;p class="no-event"&#62;délégation des événements 1&#60;/p&#62;</span><br>
              <span class="tab">&#60;p&#62;délégation des événements 2&#60;/p&#62; </span><br>
              <span class="tab">&#60;p class="no-event"&#62;délégation des événements 3&#60;/p&#62; </span><br>
              &#60;/div&#62; 
            </body>
          </code>
        </div>
        <br>
        <div class="code">
          <code>
            var element = document.getElementById('event') <br><br>
            <span class="tab">element.addEventListener('click', function(e) {</span><br>
            <span class="tabx2">var initElem = e.target;</span><br>
              <span class="tabx3">  if(initElem.className == 'no-event')</span><br>
              <span class="tabx4">return;</span><br>
                <span class="tabx3">}</span><br>
                <span class="tabx3">alert("Actif seulement sur Délégation 2")</span><br>
            })
          </code>
        </div>
        <p>Dans l'exemple ci-dessus, l'alerte est active uniquement sur l'élément 2.</p>
      </article>
      <p class="bgc-up"><a href="#up">Haut</a></p>
    </section>
  </main>
</body>
</html>